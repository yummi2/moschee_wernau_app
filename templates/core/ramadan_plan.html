{% extends "base.html" %}
{% block title %}Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±Ù…Ø¶Ø§Ù†{% endblock %}

{% block content %}
<div class="mx-auto max-w-6xl px-4" dir="rtl">
  <div class="bg-white rounded-2xl shadow p-6">

    {% with active_tab=request.GET.tab|default:"contest" %}
    <!-- Tabs -->
    <div class="flex gap-2 mb-4">
      <a href="?tab=contest"
         class="px-3 py-1 rounded-lg border
         {% if active_tab == 'contest' %} bg-blue-600 text-white border-blue-600
         {% else %} text-blue-700 hover:bg-blue-50 border-blue-200 {% endif %}">
        Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±Ù…Ø¶Ø§Ù†
      </a>

      <a href="?tab=activity"
         class="px-3 py-1 rounded-lg border
         {% if active_tab == 'activity' %} bg-blue-600 text-white border-blue-600
         {% else %} text-blue-700 hover:bg-blue-50 border-blue-200 {% endif %}">
        Ø£Ù†Ø´Ø·Ø© Ø±Ù…Ø¶Ø§Ù†
      </a>
    </div>

    <!-- Content -->
    <div class="grid gap-6 lg:grid-cols-2 items-start">

      <!-- Contest -->
      <section class="bg-white border rounded-2xl p-4 {% if active_tab != 'contest' %}hidden{% endif %}">
        

        <div class="max-h-[70vh] overflow-auto pr-1">
            <div style="
            display:grid;
            grid-template-columns: repeat(4, 1fr);
            gap:12px;
            max-width:560px;
            margin:0 auto;
          ">

          {% for d in days %}
        <a href="{% url 'ramadan_day' d.day %}"
         style="
           background:#eff6ff;
           border-radius:16px;
           padding:12px;
           text-align:center;
           font-weight:700;
           color:#1d4ed8;
           box-shadow:0 2px 8px rgba(0,0,0,.08);
           transition:background .2s;
         "
         onmouseover="this.style.background='#dbeafe'"
         onmouseout="this.style.background='#eff6ff'">
        {{ d.title }}
      </a>
        
      {% endfor %}

          </div>
        </div>
      </section>

      <!-- Activity -->
    <section class="bg-white border border-gray-200 rounded-2xl p-4 {% if active_tab != 'activity' %}hidden{% endif %}">

  {% with active_act=request.GET.act|default:"menu" %}

  {% if active_act == "menu" %}
      <!-- Activity MenÃ¼ -->
      <div style="
        display:grid;
        grid-template-columns: repeat(2, 1fr);
        gap:12px;
        max-width:280px;
        margin:0 auto;
      ">
        <a href="?tab=activity&act=questions"
        style="aspect-ratio:1/1; background:#eff6ff; border-radius:16px; padding:12px;
                display:flex; align-items:center; justify-content:center; text-align:center;
                box-shadow:0 2px 8px rgba(0,0,0,.08);
                transition: box-shadow .2s ease, transform .2s ease;"
        onmouseover="this.style.boxShadow='0 6px 16px rgba(0,0,0,.18)'; this.style.transform='translateY(-2px)'"
        onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,.08)'; this.style.transform='none'">

          <div style="font-weight:700; color:#1d4ed8;">
            ğŸ“– Ø«Ù‚Ø§ÙØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©
            <div style="margin-top:6px; font-size:12px; font-weight:400; color:#6b7280;">
              Ù…Ø³ØªÙˆÙ‰ Ù…Ø¨ØªØ¯Ø£
            </div>
          </div>
        </a>

        <a href="?tab=activity&act=drawing"
          style="aspect-ratio:1/1; background:#eff6ff; border-radius:16px; padding:12px;
                display:flex; align-items:center; justify-content:center; text-align:center;
                box-shadow:0 2px 8px rgba(0,0,0,.08);
                transition: box-shadow .2s ease, transform .2s ease;"
        onmouseover="this.style.boxShadow='0 6px 16px rgba(0,0,0,.18)'; this.style.transform='translateY(-2px)'"
        onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,.08)'; this.style.transform='none'">
          <div style="font-weight:700; color:#1d4ed8;">ğŸ¨ ØªÙ„ÙˆÙŠÙ†</div>
        </a>
        <a href="?tab=activity&act=fiqh"
        style="aspect-ratio:1/1; background:#eff6ff; border-radius:16px; padding:12px;
                display:flex; align-items:center; justify-content:center; text-align:center;
                box-shadow:0 2px 8px rgba(0,0,0,.08); grid-column: span 2;
            max-width:140px;
            margin:0 auto;
                transition: box-shadow .2s ease, transform .2s ease;"
        onmouseover="this.style.boxShadow='0 6px 16px rgba(0,0,0,.18)'; this.style.transform='translateY(-2px)'"
        onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,.08)'; this.style.transform='none'">
          <div style="font-weight:700; color:#1d4ed8;">
            ğŸ“ Ø£Ø³Ø¦Ù„Ø© ÙÙ‚Ù‡ÙŠØ©
            <div style="margin-top:6px; font-size:12px; font-weight:400; color:#6b7280;">
              Ù…Ø³ØªÙˆÙ‰ Ù…ØªÙ‚Ø¯Ù…
            </div>
          </div>
        </a>

      </div>

        {% elif active_act == "questions" %}
        <div class="bg-white">
          <h2 class="text-xl font-bold text-blue-700 mb-3">Ø«Ù‚Ø§ÙØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ© </h2>

          {% if quiz_score is not None %}
            <div class="mb-4 p-4 rounded-2xl border border-gray-200 bg-green-50 text-green-800 font-bold">
              Ù†ØªÙŠØ¬ØªÙƒ: {{ quiz_score }} / {{ quiz_total }}
            </div>
          {% endif %}

          <form method="post" class="space-y-6">
            {% csrf_token %}
            <input type="hidden" name="quiz_type" value="1">

            {% for item in quiz_questions %}
              <div class="border border-gray-200 rounded-2xl p-4">
                <div class="font-bold text-gray-900 mb-3">
                  {{ forloop.counter }}. {{ item.q }}
                </div>

                <div class="space-y-2">
                  {% for opt in item.opts %}
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="q{{ item.id }}" value="{{ forloop.counter0 }}" class="h-4 w-4">
                      <span class="text-gray-800">{{ opt }}</span>
                    </label>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}

            <button type="submit"
                    class="w-full py-3 rounded-xl bg-blue-600 text-white hover:bg-blue-700">
              Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
            </button>
          </form>
        </div>


      {% elif active_act == "drawing" %}
        <div class="bg-white">
          <h2 class="text-xl font-bold text-blue-700 mb-3">ØªÙ„ÙˆÙŠÙ†</h2>

          <div class="grid gap-3 grid-cols-2 sm:grid-cols-3">
            {% for it in drawing_items %}
              <a href="{{ it.view_url }}"
                target="_blank" rel="noopener noreferrer"
                class="block bg-blue-50 hover:bg-blue-100 rounded-xl shadow p-6 transition">
                <div class="text-lg font-bold text-blue-700">Ø§Ù„ØµÙˆØ±Ø© {{ it.n }}</div>
              </a>
              <a href="{{ it.download_url }}"
                download
                 class="block bg-blue-50 hover:bg-blue-100 rounded-xl shadow p-6 transition">
                â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© {{ it.n }}
              </a>

            {% endfor %}
          </div>
        </div>
     

      {% elif active_act == "fiqh" %}
        <div class="bg-white">
          <h2 class="text-xl font-bold text-blue-700 mb-3">Ø£Ø³Ø¦Ù„Ø© ÙÙ‚Ù‡ÙŠØ©</h2>

          {% if quiz_score is not None %}
            <div class="mb-4 p-4 rounded-2xl border border-gray-200 bg-green-50 text-green-800 font-bold">
              Ù†ØªÙŠØ¬ØªÙƒ: {{ quiz_score }} / {{ quiz_total }}
            </div>
          {% endif %}

          <form method="post" class="space-y-6">
            {% csrf_token %}
            <input type="hidden" name="quiz_type" value="fiqh">

            {% for item in fiqh_questions %}
              <div class="border border-gray-200 rounded-2xl p-4">
                <div class="font-bold text-gray-900 mb-3">
                  {{ forloop.counter }}. {{ item.q }}
                </div>

                <div class="space-y-2">
                  {% for opt in item.opts %}
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="q{{ item.id }}" value="{{ forloop.counter0 }}" class="h-4 w-4">
                      <span class="text-gray-800">{{ opt }}</span>
                    </label>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}

            <button type="submit"
                    class="w-full py-3 rounded-xl bg-blue-600 text-white hover:bg-blue-700">
              Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
            </button>
          </form>
        </div>
         {% endif %}

      {% endwith %}
    </section>
    </div>
    {% endwith %}
  </div>
</div>
{% endblock %}
