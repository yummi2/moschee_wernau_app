{% extends "base.html" %}
{% block title %}مسابقة رمضان{% endblock %}

{% block content %}
<div class="mx-auto max-w-6xl px-4" dir="rtl">
  <div class="bg-white rounded-2xl shadow p-6">

    {% with active_tab=request.GET.tab|default:"contest" %}
    <!-- Tabs -->
    <div class="flex gap-2 mb-4">
      <a href="?tab=contest"
         class="px-3 py-1 rounded-lg border
         {% if active_tab == 'contest' %} bg-blue-600 text-white border-blue-600
         {% else %} text-blue-700 hover:bg-blue-50 border-blue-200 {% endif %}">
        مسابقة رمضان
      </a>

      <a href="?tab=activity"
         class="px-3 py-1 rounded-lg border
         {% if active_tab == 'activity' %} bg-blue-600 text-white border-blue-600
         {% else %} text-blue-700 hover:bg-blue-50 border-blue-200 {% endif %}">
        أنشطة رمضان
      </a>
    </div>

    <!-- Content -->
    <div class="grid gap-6 lg:grid-cols-2 items-start">

      <!-- Contest -->
      <section class="bg-white border rounded-2xl p-4 {% if active_tab != 'contest' %}hidden{% endif %}">
        

        <div class="max-h-[70vh] overflow-auto pr-1">
          <div class="grid gap-3 grid-cols-2 sm:grid-cols-3">
          {% for d in days %}
        <a href="{% url 'ramadan_day' d.day %}"
           class="block bg-blue-50 hover:bg-blue-100 rounded-xl shadow p-6  transition">
          <div class="text-lg font-bold text-blue-700">{{ d.title }}</div>
        </a>
        
      {% endfor %}

          </div>
        </div>
      </section>

      <!-- Activity -->
<section class="bg-white border border-gray-200 rounded-2xl p-4 {% if active_tab != 'activity' %}hidden{% endif %}">

  {% with active_act=request.GET.act|default:"menu" %}

  {% if active_act == "menu" %}
    <!-- Activity Menü -->
    <div class="grid gap-3 grid-cols-2 sm:grid-cols-3">
      <a href="?tab=activity&act=questions"
         class="block bg-blue-50 hover:bg-blue-100 rounded-xl shadow p-6 transition">
        <div class="text-lg font-bold text-blue-700"> ثقافة إسلامية
          <span class="block text-sm font-normal text-gray-500 mt-1">
           مستوى مبتدأ
          </span>
        </div>
      </a>

      <a href="?tab=activity&act=drawing"
         class="block bg-blue-50 hover:bg-blue-100 rounded-xl shadow p-6 transition">
        <div class="text-lg font-bold text-blue-700"> تلوين</div>
      </a>
    </div>

        {% elif active_act == "questions" %}
        <div class="bg-white">
          <h2 class="text-xl font-bold text-blue-700 mb-3">ثقافة إسلامية </h2>

          {% if quiz_score is not None %}
            <div class="mb-4 p-4 rounded-2xl border border-gray-200 bg-green-50 text-green-800 font-bold">
              نتيجتك: {{ quiz_score }} / {{ quiz_total }}
            </div>
          {% endif %}

          <form method="post" class="space-y-6">
            {% csrf_token %}
            <input type="hidden" name="quiz" value="1">

            {% for item in quiz_questions %}
              <div class="border border-gray-200 rounded-2xl p-4">
                <div class="font-bold text-gray-900 mb-3">
                  {{ forloop.counter }}. {{ item.q }}
                </div>

                <div class="space-y-2">
                  {% for opt in item.opts %}
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="q{{ item.id }}" value="{{ forloop.counter0 }}" class="h-4 w-4">
                      <span class="text-gray-800">{{ opt }}</span>
                    </label>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}

            <button type="submit"
                    class="w-full py-3 rounded-xl bg-blue-600 text-white hover:bg-blue-700">
              إرسال الإجابات
            </button>
          </form>
        </div>


      {% elif active_act == "drawing" %}
        <div class="bg-white">
          <h2 class="text-xl font-bold text-blue-700 mb-3">تلوين</h2>

          <div class="grid gap-3 grid-cols-2 sm:grid-cols-3">
            {% for it in drawing_items %}
              <a href="{{ it.view_url }}"
                target="_blank" rel="noopener noreferrer"
                class="block bg-blue-50 hover:bg-blue-100 rounded-xl shadow p-6 transition">
                <div class="text-lg font-bold text-blue-700">الصورة {{ it.n }}</div>
              </a>
              <a href="{{ it.download_url }}"
                download
                 class="block bg-blue-50 hover:bg-blue-100 rounded-xl shadow p-6 transition">
                ⬇️ تحميل الصورة {{ it.n }}
              </a>

            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% endwith %}
    </section>
    </div>
    {% endwith %}
  </div>
</div>
{% endblock %}
